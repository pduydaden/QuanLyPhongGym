{% extends 'layout/base.html' %}
{% block conten %}

<div class="container my-5">
    <div class="user-info-container p-5 mx-auto"
         style="max-width: 700px; background-color: rgba(255,255,255,0.9); border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.2);">

        {% if msg %}
        <div class="alert alert-{{ alert_type }} text-center" role="alert">
            {{ msg }}
        </div>
        {% endif %}

        <h2 class="text-center mb-4 fw-bold">Thông tin cá nhân</h2>

        <form method="POST">
            <div class="mb-3">
                <label class="form-label">Họ và tên</label>
                <input type="text" name="name" class="form-control" value="{{ user.name }}" required>
            </div>

            <div class="mb-3">
                <label class="form-label">Giới tính</label>
                <select name="gioitinh" class="form-select" required>
                    <option value="Nam" {% if user.gioitinh=='Nam' %}selected{% endif %}>Nam</option>
                    <option value="Nữ" {% if user.gioitinh=='Nữ' %}selected{% endif %}>Nữ</option>
                </select>
            </div>

            <div class="mb-3">
                <label class="form-label">Số điện thoại</label>
                <input type="text" name="sdt" class="form-control" value="{{ user.sdt }}" required>
            </div>

            <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="text" class="form-control" name="email" value="{{ user.email }}">
            </div>

            <div class="mb-3">
                <label class="form-label">Gói tập hiện tại</label>
                <input type="text" class="form-control" value="{{ user.goitap.name }}" readonly>
            </div>

            <div class="text-center mb-4">
                <button type="submit" class="btn btn-primary btn-lg shadow">Cập nhật thông tin</button>
            </div>
        </form>
        <h3 class="mb-3 fw-bold">Danh sách Hóa đơn</h3>
        <div class="mb-3">
            <label for="filterStatus" class="form-label">Lọc theo trạng thái:</label>
            <select id="filterStatus" class="form-select" onchange="filterHoaDon()">
                <option value="all">Tất cả</option>
                <option value="paid">Đã thanh toán</option>
                <option value="unpaid">Chưa thanh toán</option>
            </select>
        </div>

        <div class="table-responsive">
            <table class="table table-striped table-bordered" id="hoadonTable">
                <thead class="table-dark">
                    <tr>
                        <th>#</th>
                        <th>Tên hóa đơn</th>
                        <th>Tổng tiền</th>
                        <th>Trạng thái</th>
                        <th>Ngày thanh toán</th>
                    </tr>
                </thead>
                <tbody>
                    {% for hd in user.hoadons %}
                    <tr data-status="{{ 'paid' if hd.trangthai else 'unpaid' }}">
                        <td>{{ loop.index }}</td>
                        <td>{{ hd.name }}</td>
                        <td>{{ "{:,.0f}".format(hd.tongtien) }} VND</td>
                        <td>{{ 'Đã thanh toán' if hd.trangthai else 'Chưa thanh toán' }}</td>
                        <td>{{ hd.ngaythanhtoan.strftime('%d/%m/%Y %H:%M') if hd.ngaythanhtoan else '-' }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

    </div>
</div>

<script>
function filterHoaDon() {
    const filter = document.getElementById('filterStatus').value;
    const rows = document.querySelectorAll('#hoadonTable tbody tr');
    rows.forEach(row => {
        const status = row.getAttribute('data-status');
        if (filter === 'all' || filter === status) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });
}
</script>

<style>
.user-info-container input[readonly] {
    background-color: #e9ecef;
}
</style>

{% endblock %}
