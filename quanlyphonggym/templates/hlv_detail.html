{% extends 'layout/base.html' %}
{% block conten %}

<div style="display:flex; justify-content:center; margin-top:30px;">
    <div style="width:90%; max-width:900px; border:2px solid #ccc; border-radius:12px; padding:30px; background-color:#fff; box-shadow:0 4px 12px rgba(0,0,0,0.1);">

        <h2 style="text-align:center; margin-bottom:30px; color:#333; border-bottom:2px solid #555; padding-bottom:5px;">
            Chi tiết kế hoạch: {{ plan.name }}
        </h2>

        <form method="POST" style="display:flex; flex-direction:column; gap:20px;">

            <div style="display:flex; flex-direction:column; gap:5px;">
                <label style="font-weight:bold; color:#555;">Chọn học viên:</label>
                <select name="user_id" style="padding:8px; border:1px solid #ccc; border-radius:4px; min-width:200px;">
                    <option value="none">-- Chưa gắn --</option>
                    {% for user in all_users %}
                    <option value="{{ user.id }}" {% if plan.user_id==user.id %}selected{% endif %}>
                        {{ user.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div>
                <h4 style="color:#555; margin-bottom:10px;">Bài tập trong kế hoạch:</h4>
                <ul id="current-baitap-list" style="list-style:none; padding:0; display:flex; flex-direction:column; gap:8px;">
                    {% for kb in plan.baitaps %}
                    <li style="padding:8px 12px; border:1px solid #ddd; border-radius:6px;
                               display:flex; justify-content:space-between; align-items:center; transition:0.2s; cursor:pointer;">
                        <span>
                            {{ kb.baitap.name }} ({{ kb.baitap.nhomco }})<br>
                            <small style="color:#777;">{{ kb.baitap.mota }}</small>
                        </span>

                        <div style="display:flex; align-items:center; gap:10px;">

                            <input type="number"
                                   name="solan_{{ kb.baitap_id }}"
                                   value="{{ kb.solan }}"
                                   min="1"
                                   style="width:70px; padding:4px;">

                            <label style="cursor:pointer; white-space:nowrap;">
                                <input type="checkbox" name="remove_baitap_ids" value="{{ kb.baitap_id }}"> Xóa
                            </label>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
            </div>

            <div>
                <h4 style="color:#555; margin-bottom:10px;">Thêm bài tập:</h4>
                <div style="position: relative; display: inline-block;">
                    <button type="button"
                            onclick="document.getElementById('baitap-list').classList.toggle('hidden')"
                            style="padding:8px 12px; border:none; background-color:#333; color:white; border-radius:4px; cursor:pointer;">
                        Chọn bài tập
                    </button>
                    <div id="baitap-list" class="hidden" style="
                        position: absolute;
                        top: 100%;
                        left: 0;
                        background: white;
                        border: 1px solid #ccc;
                        z-index: 10;
                        max-height: 200px;
                        overflow-y: auto;
                        width: 300px;
                        padding: 10px;
                        border-radius:6px;
                        box-shadow:0 2px 8px rgba(0,0,0,0.1);
                    ">
                        {% for bt in all_baitap %}
                        <label style="display:block; margin-bottom:6px; cursor:pointer;">
                            <input type="checkbox" name="add_baitap_ids" value="{{ bt.id }}">
                            {{ bt.name }} ({{ bt.nhomco }})
                            <input type="number"
                                   name="solan_new_{{ bt.id }}"
                                   placeholder="Số lần"
                                   min="1"
                                   style="width:70px; margin-left:10px;">
                        </label>
                        {% endfor %}
                    </div>
                </div>
                <small style="color:#555;">Chọn nhiều bài tập và nhập số lần</small>
            </div>

            <button type="submit" style="padding:10px; border:none; background-color:#333; color:white; border-radius:6px; width:180px; cursor:pointer; transition:0.2s;">
                Cập nhật kế hoạch
            </button>

        </form>

        <a href="{{ url_for('hlv_dashboard') }}" style="margin-top:20px; display:inline-block; color:#333; text-decoration:none; font-weight:bold; transition:0.2s;">
            &larr; Quay lại danh sách
        </a>

    </div>
</div>

<style>
.hidden { display: none; }
button:hover { opacity:0.85; }
#current-baitap-list li:hover { background-color:#f1f1f1; }
#baitap-list label:hover { background-color:#f9f9f9; }
a:hover { color:#555; }
</style>

{% endblock %}
