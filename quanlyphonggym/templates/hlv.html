{% extends 'layout/base.html' %}
{% block conten %}

<h2>Quản lý Kế hoạch tập</h2>

<!-- Thêm kế hoạch -->
<div style="margin-bottom:30px;">
    <h3>Thêm Kế Hoạch Mới</h3>
    <form method="POST">
        <input type="text" name="plan_name" placeholder="Tên kế hoạch" required>

        <!-- Chọn học viên đã được gắn HLV -->
        <select name="user_id" required>
            <option value="">-- Chọn học viên --</option>
            {% for user in all_users %}
            <option value="{{ user.id }}">{{ user.name }}</option>
            {% endfor %}
        </select>

        <!-- Chọn nhiều bài tập: popup checkbox -->
        <div style="position: relative; display: inline-block; margin-left:10px;">
            <button type="button" onclick="document.getElementById('baitap-list').classList.toggle('hidden')">
                Chọn bài tập
            </button>
            <div id="baitap-list" class="hidden" style="
                position: absolute;
                top: 100%;
                left: 0;
                background: white;
                border: 1px solid #ccc;
                z-index: 10;
                max-height: 150px;
                overflow-y: auto;
                width: 250px;
                padding: 5px;
            ">
                {% for bt in all_baitap %}
                <label style="display:block;">
                    <input type="checkbox" name="add_baitap_id" value="{{ bt.id }}"> {{ bt.name }} ({{ bt.nhomco }})
                </label>
                {% endfor %}
            </div>
        </div>
        <small>Chọn nhiều bài tập</small><br><br>

        <button type="submit">Thêm Kế Hoạch</button>
    </form>
</div>

<hr>

<!-- Thanh tìm kiếm -->
<div style="margin-bottom:10px;">
    <form method="GET" action="{{ url_for('hlv_dashboard') }}">
        <input type="text" name="search" placeholder="Tìm kiếm kế hoạch..." value="{{ search or '' }}">
        <button type="submit">Tìm</button>
    </form>
</div>

<!-- Danh sách kế hoạch -->
<h3>Danh sách Kế Hoạch</h3>
<table border="1" cellpadding="10" cellspacing="0">
    <tr>
        <th>ID</th>
        <th>Tên kế hoạch</th>
        <th>HLV quản lý</th>
        <th>Học viên</th>
        <th>Số bài tập</th>
        <th>Hành động</th>
    </tr>
    {% for plan in plans %}
    <tr>
        <td>{{ plan.id }}</td>
        <td>{{ plan.name }}</td>
        <td>{{ plan.hlv.name if plan.hlv else 'Chưa gắn' }}</td>
        <td>{{ plan.user.name if plan.user else 'Chưa gắn' }}</td>
        <td>{{ plan.baitaps.count() }} bài tập</td>
        <td>
            <a href="{{ url_for('hlv_detail', plan_id=plan.id) }}">Xem chi tiết</a>
        </td>
    </tr>
    {% endfor %}
</table>

<!-- Xóa kế hoạch -->
<div style="margin-top:20px;">
    <form method="POST">
        <select name="delete_plan_id" required>
            <option value="">-- Chọn kế hoạch để xóa --</option>
            {% for plan in plans %}
            <option value="{{ plan.id }}">{{ plan.name }}</option>
            {% endfor %}
        </select>
        <button type="submit">Xóa Kế Hoạch</button>
    </form>
</div>

<style>
.hidden { display: none; }
</style>

{% endblock %}
